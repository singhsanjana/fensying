{\theorem {\wkfence is sound}}
\begin{proof}
	\wkfence strategy checks validity of coherence conditions
	on event relations between program events and synthesized
	fences.
	
	Given a buggy trace $\tau$, we get the relations $\setHB$,
	$\setRF$, $\setMO$ and $\setRF^{-1}$ from the counter
	example generator.
	(Note that $\setFR$ relation is not invoked by any 
	coherence condition.)
	
	We compute the $\hb{\imm{\tau}}{}{}$ relation after introducing 
	the synthesized fences in the intermediate trace $\imm{\tau}$, 
	hence, the soundness condition can be defined as: 
	\ourtechnique soundly detects all weak cycle without modifying 
	$\setRF$, $\setMO$ and $\setRF^{-1}$ relations for the events of 
	$\imm{\tau}$ (\ie $\rf{\imm{\tau}}{}{} = \setRF$, 
	$\mo{\imm{\tau}}{}{} = \setMO$ and $\rfinv{\imm{\tau}}{}{} = 
	\setRF^{-1}$).
	
	\begin{figure}[h]
		\begin{tabular}{|c|c|c|c|}
			\hline
			\resizebox{0.19\textwidth}{!}{\input{figures/coWW.tex}} &
			\resizebox{0.25\textwidth}{!}{\input{figures/coWR.tex}} &
			\resizebox{0.25\textwidth}{!}{\input{figures/coRW.tex}} &
			\resizebox{0.27\textwidth}{!}{\input{figures/coRR.tex}} \\
			\hline
		\end{tabular}
		\label{fig:como}
	\end{figure}
	
	
	\begin{itemize}[label=setmm,align=left,leftmargin=*]
		\item [$\setRF$] The relation is formed from write events 
			to read events, since fences cannot be both the $\setRF$
			relations remains unchanged \ie $\rf{\imm{\tau}}{}{}$ =
			$\setRF$.
		
		\item [$\setRF^{-1}$] The relation remains unchanged as 
			$\setRF$ remains unchanged \ie $\rfinv{\imm{\tau}}{}{}$ 
			= $\setRF^{-1}$.
		
		\item [$\setMO$] Assume $\exists w, w' \in \events_\tau$ \st 
			as a consequence of synthesizing fences in the buggy trace 
			$\tau$ to form $\imm{\tau}$, $w$ is modification-ordered
			before $w'$. However, $(w,w') \nin \mo{\imm{\tau}}{}{}$
			since we consider $\mo{\imm{\tau}}{}{}$ = $\setMO$.
			
			We show by case analysis on the coherence conditions
			involving $\mo{\imm{\tau}}{}{}$ that \ourtechnique does
			not miss a weak cycle by not expanding modification-order
			after synthesizing fences.
		
			Consider the following coherence conditions involving 
			$\mo{\imm{\tau}}{}{}$:
		
			\begin{itemize}[label=CoWW,align=left,leftmargin=*]
			\item [CoWW:] Let $\exists w_1, w_2 \in \writes$
				\st $\hb{\imm{\tau}}{w_1}{w_2}$. 
			
				If $\mo{\tau}{w_1}{w_2}$ then there does not
				exist a violation of any coherence condition.
			
				However, if $\mo{\tau}{w_2}{w_1}$ then we will 
				detect the violation as a cycle in 
				$\mo{\imm{\tau}}{}{};\hb{\imm{\tau}}{}{}$
				(depicted diagrammatically in \hlref{coWW}).
			
			\item [CoWR:] Let $\exists r_1 \in \reads$, 
				$\exists w_1,w_2 \in \writes$ 
				\st $\hb{\imm{\tau}}{w_1}{r_1}$ and 
					$\rf{\imm{\tau}}{w_2}{r_1}$.
			
				If $\mo{\tau}{w_1}{w_2}$ then there does not
				exist a violation of any coherence condition.
			
				However, if $\mo{\tau}{w_2}{w_1}$ then we will 
				detect the violation as a cycle in 
				$\mo{\imm{\tau}}{}{};\hb{\imm{\tau}}{}{};\rfinv{\imm{\tau}}{}{}$
				(depicted diagrammatically in \hlref{coWR}).
				
			\item [CoRW:] Let $\exists r_1 \in \reads$, 
				$\exists w_1,w_2 \in \writes$ 
				\st $\rf{\imm{\tau}}{w_1}{r_1}$ and 
				$\hb{\imm{\tau}}{r_1}{w_2}$.
			
				If $\mo{\tau}{w_1}{w_2}$ then there does not
				exist a violation of any coherence condition.
			
				However, if $\mo{\tau}{w_2}{w_1}$ then we will 
				detect the violation as a cycle in 
				$\mo{\imm{\tau}}{}{};\rf{\imm{\tau}}{}{};\hb{\imm{\tau}}{}{}$
				(depicted diagrammatically in \hlref{coRW}).
			
			\item [CoRR:] Let $\exists r_1,r_2 \in \reads$,
				$\exists w_1, w_2 \in \writes$
				\st $\rf{\imm{\tau}}{w_1}{r_1}$, 
					$\rf{\imm{\tau}}{w_2}{r_2}$ and
					$\hb{\imm{\tau}}{r_1}{r_2}$. 
					
					If $\mo{\tau}{w_1}{w_2}$ then there does not
					exist a violation of any coherence condition.
					
					However, if $\mo{\tau}{w_2}{w_1}$ then we will 
					detect the violation as a cycle in 
					$\mo{\imm{\tau}}{}{};\rf{\imm{\tau}}{}{};\hb{\imm{\tau}}{}{};\rfinv{\imm{\tau}}{}{}$
					(depicted diagrammatically in \hlref{coRR}).
		\end{itemize}
	\end{itemize}

	Thus, \ourtechnique does not miss a cycle in any
	coherence rule and	\wkfence is sound.
\end{proof}

{\theorem {\stfence is sound}}
\begin{proof}
\end{proof}